from flask import Flask, request
import effects
import lights
import json

print lights.strip.numPixels()
#print json.loads('[16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215]')


for i in range(0, lights.strip.numPixels()):
	lights.strip.setPixelColor(i, 0xFF0000)
	lights.strip.show()

app = Flask(__name__)

#effects.raw.info()

@app.route('/')
def hello_world():
	return 'Hello World!'

@app.route('/api/set/<effect_name>')
def effect_handler(effect_name):
#	return request.args['yes']
	#return
	#input7 = request.args['leds']
	#print input7
	#print json.loads(request.args['leds'])
	#yue =  json.loads(input7)#json.loads('[16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 16777215, 1677)
	#print yue
	if(hasattr(effects, effect_name)):
		getattr(effects, effect_name).info()
		getattr(effects, effect_name).run(lights.strip, request.args)
		return effect_name + 'idiot'
#	else:
#		return effect_name + ' - no luck'

if __name__ == '__main__' :
	app.run(host='0.0.0.0', port=80)
